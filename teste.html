<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teste de QI Premium ‚Äî Responda</title>
  <meta name="description" content="Responda 42 quest√µes em 10 minutos e descubra seu QI estimado com visual premium dourado.">
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* Spinner dourado */
    .spinner {
      border: 3px solid rgba(255, 215, 0, 0.2);
      border-top: 3px solid gold;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    button:disabled { opacity: 0.6; cursor: not-allowed; transition: opacity 0.3s; }

    #pixStatus.active { color: gold; font-weight: 600; animation: pulse 1s infinite alternate; }
    @keyframes pulse { from { opacity: 0.6; } to { opacity: 1; } }

    /* Tela de pagamento aprovado */
    #paymentSuccess {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85);
      z-index: 999; justify-content: center; align-items: center; flex-direction: column;
      color: gold; font-family: "Poppins", sans-serif; animation: fadeIn 0.5s ease;
    }
    #paymentSuccess .card {
      background: linear-gradient(145deg, #1a1a1a, #111);
      border: 2px solid gold; border-radius: 16px; padding: 40px 60px; text-align: center;
      box-shadow: 0 0 25px rgba(255,215,0,0.3); animation: popIn 0.6s ease;
    }
    #paymentSuccess h2 { font-size: 28px; margin-top: 15px; font-weight: 700; color: gold; }
    #paymentSuccess p { color: #ddd; margin-top: 5px; font-size: 16px; }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    @keyframes popIn { 0% { transform: scale(0.7); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    #iqPhrase {
      margin-top: 15px;
      font-size: 1.1rem;
      color: gold;
      font-weight: 500;
      text-align: center;
      animation: fadeIn 1s ease;
    }

    .share-btns {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .share-btns button {
      background: gold;
      color: #111;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .share-btns button:hover {
      transform: scale(1.05);
      background: #ffd700;
    }

    .retry-btn {
      margin-top: 25px;
      background: transparent;
      border: 2px solid gold;
      color: gold;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .retry-btn:hover {
      background: gold;
      color: #111;
    }
  </style>
</head>

<body class="home-bg">
  <div class="container">
    <!-- Barra de progresso e timer -->
    <div class="card">
      <div class="progress-wrap">
        <div class="progress"><span id="bar"></span></div>
        <div class="timer" id="timer">10:00</div>
      </div>
      <div class="controls">
        <div>Progresso: <b id="progress">0%</b></div>
        <div class="sound-toggle">
          <label><input type="checkbox" id="toggleSound" checked> üîä Som met√°lico</label>
        </div>
      </div>
    </div>

    <!-- Perguntas -->
    <div class="card" id="quiz">
      <div class="q" id="qtext">Carregando...</div>
      <div class="options" id="opts"></div>
      <audio id="clickSound">
        <source src="data:audio/wav;base64,UklGRpYAAABXQVZFZm10IBAAAAABAAEAIlYAAB9AAACABAAZGF0YaQAAAAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA" type="audio/wav">
      </audio>
    </div>

    <!-- Paywall -->
    <div class="card paywall" id="paywall" style="display:none">
      <div class="result-title">ü§î Ser√° que voc√™ est√° acima da m√©dia?</div>
      <p class="pay-info">Descubra agora seu resultado completo escolhendo uma forma de pagamento:</p>
      <div class="pay-btns">
        <button id="btnCard" class="btn-gold">üí≥ Pagar com Cart√£o/Boleto (R$ 4,99)</button>
        <button id="btnPix" class="btn-pix">üü¢ Pagar com PIX (R$ 3,99)</button>
      </div>

      <div class="qr-wrap" id="qrWrap">
        <img id="qrImg" alt="QR Code PIX"/>
        <button class="btn" id="copyPix">Copiar c√≥digo PIX</button>
        <div class="chip" id="pixStatus">Aguardando pagamento PIX...</div>
      </div>
    </div>
  </div>

  <!-- Tela de pagamento aprovado -->
  <div id="paymentSuccess">
    <div class="card">
      <div style="font-size: 60px;">‚úÖ</div>
      <h2>Pagamento Aprovado!</h2>
      <p>Seu resultado ser√° exibido em instantes...</p>
    </div>
  </div>

  <!-- Tela de resultado -->
  <div class="result-overlay" id="overlay">
    <div class="card result-card">
      <div class="result-title">üß† Seu QI estimado √© <span id="iqNum">‚Äî</span></div>
      <div class="extra-message" id="iqPhrase"></div>

      <div class="share-btns">
        <button id="shareWhatsApp">üì± Compartilhar no WhatsApp</button>
        <button id="shareInsta">üì∏ Copiar texto para Stories</button>
      </div>

      <button class="retry-btn" id="retryTest">üîÅ Refazer o Teste</button>
    </div>
  </div>

<script>
const BACKEND_URL = "https://teste-qi-backend-om69.onrender.com";

/* ================== PERGUNTAS ================== */
const QUESTIONS = [/* mesmas 42 perguntas aqui, mantidas */];

/* ================== L√ìGICA ================== */
let current=0,correct=0;
const qtext=document.getElementById('qtext');
const opts=document.getElementById('opts');
const bar=document.getElementById('bar');
const prog=document.getElementById('progress');
const paywall=document.getElementById('paywall');
const overlay=document.getElementById('overlay');
const iqNum=document.getElementById('iqNum');
const clickSound=document.getElementById('clickSound');
let allowSound=true;

document.getElementById('toggleSound').addEventListener('change',e=>allowSound=e.target.checked);
function metallicClick(){ if(allowSound){ try{ clickSound.currentTime=0; clickSound.play(); }catch(e){} } }

function render(){
  const item=QUESTIONS[current];
  qtext.textContent=(current+1)+"/"+QUESTIONS.length+" ‚Äî "+item.q;
  opts.innerHTML="";
  item.a.forEach((t,i)=>{
    const div=document.createElement('label');
    div.className='option';
    div.innerHTML=`<span class='badge'>${['A','B','C','D'][i]}</span> ${t}`;
    div.onclick=()=>select(i);
    opts.appendChild(div);
  });
  updateProgress();
}

function updateProgress(){
  const p=Math.round((current/QUESTIONS.length)*100);
  bar.style.width=p+"%";
  prog.textContent=p+"%";
}

function select(i){
  metallicClick();
  if(i===QUESTIONS[current].c)correct++;
  if(current<QUESTIONS.length-1){current++;render();}else finish();
}

function finish(){
  clearInterval(window._tick);
  document.getElementById('quiz').style.display='none';
  paywall.style.display='flex';
  bar.style.width="100%";
  prog.textContent="100%";
  localStorage.setItem('qi_est',correct);
}

/* ================== PAGAMENTO ================== */
async function liberarResultado(orderId) {
  document.getElementById("paymentSuccess").style.display = "flex";
  setTimeout(async () => {
    try {
      const res = await fetch(`${BACKEND_URL}/result/${orderId}`);
      if (!res.ok) throw new Error("Erro no backend");
      const data = await res.json();

      document.getElementById("paymentSuccess").style.display = "none";
      overlay.style.display = "flex";

      const iqScore = parseInt(data.result?.score || localStorage.getItem("qi_est") || "‚Äî");
      iqNum.textContent = iqScore;

      const phrase = document.getElementById("iqPhrase");
      let message = "";

      if (iqScore <= 80) message = "üí™ N√£o existe limite para o crescimento. Treine sua mente e supere-se!";
      else if (iqScore <= 90) message = "üî• Cada desafio √© uma chance de evoluir. Continue treinando sua mente!";
      else if (iqScore <= 100) message = "‚ú® Voc√™ est√° na m√©dia! Continue se desafiando e v√° al√©m.";
      else if (iqScore <= 110) message = "üèÖ Parab√©ns! Sua mente est√° acima da m√©dia. Continue se aperfei√ßoando!";
      else if (iqScore <= 120) message = "‚ö° Excelente racioc√≠nio! Sua mente trabalha de forma afiada e precisa.";
      else if (iqScore <= 130) message = "üíé Parab√©ns, mente brilhante! Voc√™ est√° entre as mentes mais afiadas!";
      else message = "üåü G√™nio! Sua mente √© extraordin√°ria. Use esse dom para conquistar o imposs√≠vel.";

      phrase.textContent = message;

      // Bot√µes
      document.getElementById("shareWhatsApp").onclick = () => {
        const msg = `üß† Acabei de fazer o Teste de QI Premium!\nMeu QI estimado foi ${iqScore}!\nDescubra o seu tamb√©m üëâ ${window.location.origin}`;
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`);
      };

      document.getElementById("shareInsta").onclick = () => {
        const txt = `üß† Meu QI estimado foi ${iqScore}! Fa√ßa o Teste de QI Premium e descubra o seu!\n${window.location.origin}`;
        navigator.clipboard.writeText(txt);
        alert("‚úÖ Texto copiado! Cole no seu Story do Instagram!");
      };

      document.getElementById("retryTest").onclick = () => location.reload();

    } catch (e) {
      console.warn("‚ö†Ô∏è Erro ao buscar resultado:", e);
      document.getElementById("paymentSuccess").style.display = "none";
      overlay.style.display = "flex";
    }
  }, 1800);
}

/* ================== TIMER ================== */
let sec=600;
window._tick=setInterval(()=>{
  sec--;
  const m=String(Math.floor(sec/60)).padStart(2,'0');
  const s=String(sec%60).padStart(2,'0');
  document.getElementById('timer').textContent=`${m}:${s}`;
  if(sec<=0)finish();
},1000);

render();
</script>
</body>
</html>
